<% layout("/layouts/boilerplate") -%>

<div class="listing-detail-container">
  <div class="listing-header">
    <h1 class="listing-detail-title"><%= listing_x.title %></h1>
  </div>

  <div class="listing-content">
    <div class="listing-image-section">
      <img src="<%= listing_x.image %>" alt="<%= listing_x.title %>" class="listing-detail-image">
    </div>

    <div class="listing-info-section">
      <div class="listing-details-card">
        <div class="listing-description">
          <p><%= listing_x.description %></p>
        </div>

        <div class="listing-meta">
          <div class="listing-price">
            <span class="price-amount">&#8377;<%= listing_x.price.toLocaleString("en-IN") %></span>
            <span class="price-unit">per night</span>
          </div>
          <div class="listing-location">
            <span class="location-text"><%= listing_x.location %>, <%= listing_x.country %></span>
          </div>
        </div>

        <div class="listing-actions">
          <a href="/pathlistings/<%= listing_x._id %>/edit" class="btn btn-edit">Edit Listing</a>
          <form method="post" action="/pathlistings/<%= listing_x._id %>?_method=DELETE" class="delete-form">
            <button type="submit" class="btn btn-delete">Delete Listing</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <div class="reviews-section">
    <% if (currentUser) { %>
      <h2 class="section-title">Leave a Review</h2>
      <form action="/pathlistings/<%= listing_x._id %>/reviews" method="post" class="review-form">
        <div class="form-group">
          <label for="rating" class="form-label">Rating</label>
          <div class="rating-input">
            <input type="range" name="review[rating]" id="rating" min="1" max="5" class="rating-slider">
            <div class="rating-labels">
              <span>1</span>
              <span>2</span>
              <span>3</span>
              <span>4</span>
              <span>5</span>
            </div>
          </div>
        </div>

        <div class="form-group">
          <label for="comment" class="form-label">Comment</label>
          <textarea name="review[comment]" id="comment" rows="5" class="form-textarea" required></textarea>
        </div>

        <button type="submit" class="btn btn-submit">Submit Review</button>
      </form>
    <% } else { %>
      <div class="guest-message">
        <p>You must be logged in to leave a review. Please <a href="/login">login</a> or <a href="/signup">signup</a> to continue.</p>
      </div>
    <% } %>

    <h2 class="section-title">All Reviews</h2>
    <div class="reviews-grid">
      <% for (review of listing_x.reviews) { %>
        <div class="review-card">
          <div class="review-header">
            <h4 class="review-author">Jay Ahirrao</h4>
            <div class="review-rating">
              <% for (let i = 1; i <= 5; i++) { %>
                <span class="star <%= i <= review.rating ? 'filled' : '' %>">â˜…</span>
              <% } %>
            </div>
          </div>
          <p class="review-comment"><%= review.comment %></p>
          <form method="post" action="/pathlistings/<%= listing_x._id %>/reviews/<%= review._id %>?_method=DELETE" class="review-delete-form">
            <button type="submit" class="btn btn-delete-small">Delete</button>
          </form>
        </div>
      <% } %>
    </div>
  </div>
</div>
